- name: "Run command {{ _command }}"
  block:
  - name: Create temporary file
    tempfile:
      state: file
      suffix: sh
    register: tempfile_output
  - include_tasks: tasks/create_shell_script.yml
    vars:
      _script_path: "{{ tempfile_output.path }}"
  - name: "Running script {{ tempfile_output.path }}"
    command: bash -lc "{{ tempfile_output.path }}"
    register: _command_result_register
    ignore_errors: "{{ _command_ignore_errors | default(false, true) }}"
  always:
  - name: "Deleting file {{ tempfile_output.path }}"
    file:
      path: "{{ tempfile_output.path }}"
      state:  absent
